---------------- MODULE /home/wego/modle_based_test_raft/tla/simulation_2022-04-07_09-47-26_1/trace_0_40 -----------------
STATE_1 == 
/\ elections = {}
/\ messages = {}
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"Init">>
/\ state = (s1 :> Follower @@ s2 :> Follower @@ s3 :> Follower)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {} @@ s2 :> {} @@ s3 :> {})
/\ scr = [nSent |-> 0, lock |-> Nil]
/\ votedFor = (s1 :> Nil @@ s2 :> Nil @@ s3 :> Nil)


STATE_2 == 
/\ elections = {}
/\ messages = {}
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"Timeout: election", s3>>
/\ state = (s1 :> Follower @@ s2 :> Follower @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 1 @@ s2 :> 1 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {} @@ s2 :> {} @@ s3 :> {s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 0 ]
/\ votedFor = (s1 :> Nil @@ s2 :> Nil @@ s3 :> s3)


STATE_3 == 
/\ elections = {}
/\ messages = { [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s3, s1, 1>>
/\ state = (s1 :> Follower @@ s2 :> Follower @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 1 @@ s2 :> 1 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {} @@ s2 :> {} @@ s3 :> {s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 1 ]
/\ votedFor = (s1 :> Nil @@ s2 :> Nil @@ s3 :> s3)


STATE_4 == 
/\ elections = {}
/\ messages = { [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 2 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s3, s2, 2>>
/\ state = (s1 :> Follower @@ s2 :> Follower @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 1 @@ s2 :> 1 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {} @@ s2 :> {} @@ s3 :> {s3})
/\ scr = [lock |-> Nil, nSent |-> 2]
/\ votedFor = (s1 :> Nil @@ s2 :> Nil @@ s3 :> s3)


STATE_5 == 
/\ elections = {}
/\ messages = { [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ],
  [ type |-> RequestVoteResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, voteGranted |-> TRUE],
    seq |-> 3 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"HandleRequestVoteRequest: demote and granted ", s2, s3, 2>>
/\ state = (s1 :> Follower @@ s2 :> Follower @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 1 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {} @@ s2 :> {} @@ s3 :> {s3})
/\ scr = [nSent |-> 3, lock |-> Nil]
/\ votedFor = (s1 :> Nil @@ s2 :> s3 @@ s3 :> s3)


STATE_6 == 
/\ elections = {}
/\ messages = { [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"HandleRequestVoteResponse: promote", s3, s2, 3>>
/\ state = (s1 :> Follower @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 1 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 3 ]
/\ votedFor = (s1 :> Nil @@ s2 :> s3 @@ s3 :> s3)


STATE_7 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 4>>
/\ state = (s1 :> Follower @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 1 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 4 ]
/\ votedFor = (s1 :> Nil @@ s2 :> s3 @@ s3 :> s3)


STATE_8 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 5>>
/\ state = (s1 :> Follower @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 1 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 5]
/\ votedFor = (s1 :> Nil @@ s2 :> s3 @@ s3 :> s3)


STATE_9 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"Timeout: election", s1>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s1, to |-> s2], [from |-> s1, to |-> s3]} ],
  nSent |-> 5 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_10 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s1, s2, 6>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s1, to |-> s3]}],
  nSent |-> 6 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_11 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s1, s3, 7>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 7]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_12 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s1, s3, 7>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 7]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_13 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 7 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_14 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 8>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 8 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_15 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 9 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 9>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 9]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_16 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 9 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 9 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_17 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 10 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 9 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 10>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 10 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_18 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 10 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 9 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 11>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 11]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_19 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 9 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"HandleAppendEntriesRequest: success", s1, s3, 10>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 2 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 12, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_20 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 9 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"Timeout: election", s1>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s1, to |-> s2], [from |-> s1, to |-> s3]} ],
  nSent |-> 12 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_21 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 9 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s1, s2, 13>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s1, to |-> s3]}],
  nSent |-> 13 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_22 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 9 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s1, s3, 14>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 14]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_23 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"HandleAppendEntriesRequest: success", s2, s3, 9>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 15, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_24 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 15 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_25 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 16>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 16 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_26 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 2, candidate |-> s3, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 1 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 17>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 17]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_27 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 8 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"HandleRequestVoteRequest: stale msg", s1, s3, 1>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 17]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_28 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 7 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"HandleAppendEntriesRequest: stale msg", s1, s3, 8>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 18, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_29 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"HandleRequestVoteRequest: leader not granted", s3, s1, 7>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 19, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_30 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 19 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_31 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 20>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 20 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_32 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 21>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 21]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_33 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 21>>
/\ state = (s1 :> Candidate @@ s2 :> Follower @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 2 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 21]
/\ votedFor = (s1 :> s1 @@ s2 :> s3 @@ s3 :> s3)


STATE_34 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"Timeout: election", s2>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 3 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s2, to |-> s1], [from |-> s2, to |-> s3]} ],
  nSent |-> 21 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_35 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s2, s1, 22>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 3 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s2, to |-> s3]}],
  nSent |-> 22 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_36 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s2, s3, 23>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 3 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 23]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_37 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"Timeout: election", s2>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s2, to |-> s1], [from |-> s2, to |-> s3]} ],
  nSent |-> 23 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_38 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s2, s1, 24>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s2, to |-> s3]}],
  nSent |-> 24 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_39 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<>>)
/\ pc = <<"DoLoop: RequestVote", s2, s3, 25>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 25]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_40 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 19 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"ClientRequest", s3, v1>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 25]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_41 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"HandleRequestVoteResponse: stale msg", s1, s3, 19>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 25]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_42 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 25 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_43 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 26>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 26 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_44 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 27>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 3 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 27]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_45 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"Timeout: election", s1>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s1, to |-> s2], [from |-> s1, to |-> s3]} ],
  nSent |-> 27 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_46 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"DoLoop: RequestVote", s1, s2, 28>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s1, to |-> s3]}],
  nSent |-> 28 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_47 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"DoLoop: RequestVote", s1, s3, 29>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 29]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_48 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"DoLoop: RequestVote", s1, s3, 29>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 29]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_49 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 29 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_50 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 30>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 30 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_51 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 4 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 31>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 31]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_52 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"HandleAppendEntriesRequest: stale msg", s1, s3, 4>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 4 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 32, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_53 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"Timeout: election", s2>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s2, to |-> s1], [from |-> s2, to |-> s3]} ],
  nSent |-> 32 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_54 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"DoLoop: RequestVote", s2, s1, 33>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s2, to |-> s3]}],
  nSent |-> 33 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_55 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 2, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 6 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"DoLoop: RequestVote", s2, s3, 34>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 34]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_56 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = (s1 :> <<>> @@ s2 :> <<>> @@ s3 :> <<[term |-> 2, value |-> v1]>>)
/\ pc = <<"HandleRequestVoteRequest: stale msg", s2, s1, 6>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 34]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_57 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 13 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"ClientRequest", s3, v5>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 34]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_58 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"HandleRequestVoteRequest: stale msg", s2, s1, 13>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 34]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_59 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 34 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_60 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 35>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 35 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_61 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 31 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 36>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 36]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_62 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"HandleAppendEntriesRequest: stale msg", s2, s3, 31>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 37, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_63 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 37 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_64 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 38>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 38 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_65 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 39>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 39]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_66 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 39 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_67 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 40>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 40 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_68 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 41>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 5 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 41]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_69 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"Timeout: election", s2>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 6 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s2, to |-> s1], [from |-> s2, to |-> s3]} ],
  nSent |-> 41 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_70 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: RequestVote", s2, s1, 42>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 6 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s2, to |-> s3]}],
  nSent |-> 42 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_71 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 36 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: RequestVote", s2, s3, 43>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 6 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 43]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_72 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 33 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"HandleAppendEntriesRequest: stale msg", s2, s3, 36>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 4 @@ s2 :> 6 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 44, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_73 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"HandleRequestVoteRequest: demote and not granted ", s1, s2, 33>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 5 @@ s2 :> 6 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 45, lock |-> Nil]
/\ votedFor = (s1 :> Nil @@ s2 :> s2 @@ s3 :> s3)


STATE_74 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"HandleAppendEntriesResponse: success", s3, s1, 12>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 5 @@ s2 :> 6 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 45, lock |-> Nil]
/\ votedFor = (s1 :> Nil @@ s2 :> s2 @@ s3 :> s3)


STATE_75 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"Timeout: election", s2>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 5 @@ s2 :> 7 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s2, to |-> s1], [from |-> s2, to |-> s3]} ],
  nSent |-> 45 ]
/\ votedFor = (s1 :> Nil @@ s2 :> s2 @@ s3 :> s3)


STATE_76 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 46 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: RequestVote", s2, s1, 46>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 5 @@ s2 :> 7 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s2, to |-> s3]}],
  nSent |-> 46 ]
/\ votedFor = (s1 :> Nil @@ s2 :> s2 @@ s3 :> s3)


STATE_77 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 29 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 46 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"DoLoop: RequestVote", s2, s3, 47>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 5 @@ s2 :> 7 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 47]
/\ votedFor = (s1 :> Nil @@ s2 :> s2 @@ s3 :> s3)


STATE_78 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 46 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>> )
/\ pc = <<"HandleRequestVoteRequest: leader not granted", s3, s1, 29>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 5 @@ s2 :> 7 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 48, lock |-> Nil]
/\ votedFor = (s1 :> Nil @@ s2 :> s2 @@ s3 :> s3)


STATE_79 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 20 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 46 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"ClientRequest", s3, v4>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 5 @@ s2 :> 7 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 48, lock |-> Nil]
/\ votedFor = (s1 :> Nil @@ s2 :> s2 @@ s3 :> s3)


STATE_80 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 46 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"HandleAppendEntriesRequest: stale msg", s1, s3, 20>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 5 @@ s2 :> 7 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 49, lock |-> Nil]
/\ votedFor = (s1 :> Nil @@ s2 :> s2 @@ s3 :> s3)


STATE_81 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 46 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"ClientRequest", s3, v2>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 5 @@ s2 :> 7 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 49, lock |-> Nil]
/\ votedFor = (s1 :> Nil @@ s2 :> s2 @@ s3 :> s3)


STATE_82 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 14 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"HandleRequestVoteRequest: demote and granted ", s1, s2, 46>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 7 @@ s2 :> 7 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 50, lock |-> Nil]
/\ votedFor = (s1 :> s2 @@ s2 :> s2 @@ s3 :> s3)


STATE_83 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"HandleRequestVoteRequest: leader not granted", s3, s1, 14>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 7 @@ s2 :> 7 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 51, lock |-> Nil]
/\ votedFor = (s1 :> s2 @@ s2 :> s2 @@ s3 :> s3)


STATE_84 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"Timeout: election", s2>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 7 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s2, to |-> s1], [from |-> s2, to |-> s3]} ],
  nSent |-> 51 ]
/\ votedFor = (s1 :> s2 @@ s2 :> s2 @@ s3 :> s3)


STATE_85 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"DoLoop: RequestVote", s2, s1, 52>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 7 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s2, to |-> s3]}],
  nSent |-> 52 ]
/\ votedFor = (s1 :> s2 @@ s2 :> s2 @@ s3 :> s3)


STATE_86 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 53 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"DoLoop: RequestVote", s2, s3, 53>>
/\ state = (s1 :> Follower @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 7 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 53]
/\ votedFor = (s1 :> s2 @@ s2 :> s2 @@ s3 :> s3)


STATE_87 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 53 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"Timeout: election", s1>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s1, to |-> s2], [from |-> s1, to |-> s3]} ],
  nSent |-> 53 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_88 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 53 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"DoLoop: RequestVote", s1, s2, 54>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s1, to |-> s3]}],
  nSent |-> 54 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_89 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 53 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"DoLoop: RequestVote", s1, s3, 55>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 55]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_90 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 26 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"HandleRequestVoteRequest: leader not granted", s3, s2, 53>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 56, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_91 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"HandleAppendEntriesRequest: stale msg", s1, s3, 26>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 57, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_92 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 57 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_93 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 58>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 58 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_94 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 59>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 59]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_95 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"AppendEntriesAll", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> AppendEntriesRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 59 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_96 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"DoLoop: AppendEntries", s3, s1, 60>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> AppendEntriesRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 60 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_97 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2] >> )
/\ pc = <<"DoLoop: AppendEntries", s3, s2, 61>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 61]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_98 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"ClientRequest", s3, v4>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 8 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 61]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_99 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"Timeout: election", s1>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s1, to |-> s2], [from |-> s1, to |-> s3]} ],
  nSent |-> 61 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_100 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"DoLoop: RequestVote", s1, s2, 62>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s1, to |-> s3]}],
  nSent |-> 62 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_101 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"DoLoop: RequestVote", s1, s3, 63>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 8 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 63]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_102 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"Timeout: election", s2>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 9 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s2, to |-> s1], [from |-> s2, to |-> s3]} ],
  nSent |-> 63 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_103 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"DoLoop: RequestVote", s2, s1, 64>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 9 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s2, to |-> s3]}],
  nSent |-> 64 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_104 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"DoLoop: RequestVote", s2, s3, 65>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 9 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 65]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_105 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4] >> )
/\ pc = <<"DoLoop: RequestVote", s2, s3, 65>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 9 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 65]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_106 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"ClientRequest", s3, v1>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 9 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 65]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_107 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"Timeout: election", s2>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s2, to |-> s1], [from |-> s2, to |-> s3]} ],
  nSent |-> 65 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_108 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"DoLoop: RequestVote", s2, s1, 66>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s2, to |-> s3]}],
  nSent |-> 66 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_109 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 49 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"DoLoop: RequestVote", s2, s3, 67>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Leader)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 2)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 67]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_110 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 60 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"HandleAppendEntriesResponse: demote", s3, s1, 49>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Follower)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 5)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [lock |-> Nil, nSent |-> 67]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> Nil)


STATE_111 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 35 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"HandleAppendEntriesRequest: stale msg", s1, s3, 60>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Follower)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 5)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 68, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> Nil)


STATE_112 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 6, success |-> FALSE, curIdx |-> 0],
    seq |-> 44 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"HandleAppendEntriesRequest: stale msg", s1, s3, 35>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Follower)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 5)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 69, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> Nil)


STATE_113 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 48 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"HandleAppendEntriesResponse: not leader", s3, s2, 44>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Follower)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 5)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 69, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> Nil)


STATE_114 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 42 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"HandleRequestVoteResponse: stale msg", s1, s3, 48>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Follower)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 5)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 69, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> Nil)


STATE_115 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"HandleRequestVoteRequest: stale msg", s1, s2, 42>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Follower)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 5)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s2, s3})
/\ scr = [nSent |-> 69, lock |-> Nil]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> Nil)


STATE_116 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"Timeout: election", s3>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 6)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s3, to |-> s1], [from |-> s3, to |-> s2]} ],
  nSent |-> 69 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_117 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s3, lastLogIdx |-> 6, lastLogTerm |-> 2],
    seq |-> 70 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"DoLoop: RequestVote", s3, s1, 70>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 6)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s3, to |-> s2]}],
  nSent |-> 70 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_118 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 23 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s3, lastLogIdx |-> 6, lastLogTerm |-> 2],
    seq |-> 70 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [term |-> 6, candidate |-> s3, lastLogIdx |-> 6, lastLogTerm |-> 2],
    seq |-> 71 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"DoLoop: RequestVote", s3, s2, 71>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 6)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s3})
/\ scr = [lock |-> Nil, nSent |-> 71]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_119 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s3, lastLogIdx |-> 6, lastLogTerm |-> 2],
    seq |-> 70 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [term |-> 6, candidate |-> s3, lastLogIdx |-> 6, lastLogTerm |-> 2],
    seq |-> 71 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"HandleRequestVoteRequest: stale msg", s3, s2, 23>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 10 @@ s3 :> 6)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s3})
/\ scr = [lock |-> Nil, nSent |-> 71]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_120 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s3, lastLogIdx |-> 6, lastLogTerm |-> 2],
    seq |-> 70 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [term |-> 6, candidate |-> s3, lastLogIdx |-> 6, lastLogTerm |-> 2],
    seq |-> 71 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"Timeout: election", s2>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 11 @@ s3 :> 6)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s3})
/\ scr = [ lock |->
      [ type |-> RequestVoteRequest,
        args |-> {[from |-> s2, to |-> s1], [from |-> s2, to |-> s3]} ],
  nSent |-> 71 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


STATE_121 == 
/\ elections = {}
/\ messages = { [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 16 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 30 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 38 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 40 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 58 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 5 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 11 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 17 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 21 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 27 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 39 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |-> <<[term |-> 2, value |-> v1], [term |-> 2, value |-> v5]>>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 41 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 59 ],
  [ type |-> AppendEntriesRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [ log |->
              << [term |-> 2, value |-> v1],
                 [term |-> 2, value |-> v5],
                 [term |-> 2, value |-> v4],
                 [term |-> 2, value |-> v2] >>,
          commitIndex |-> 0,
          term |-> 2,
          entries |-> <<[term |-> 2, value |-> v1]>>,
          prevLogIndex |-> 0,
          prevLogTerm |-> 0 ],
    seq |-> 61 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 12 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 3, success |-> FALSE, curIdx |-> 0],
    seq |-> 18 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 4, success |-> FALSE, curIdx |-> 0],
    seq |-> 32 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 8, success |-> FALSE, curIdx |-> 0],
    seq |-> 57 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 68 ],
  [ type |-> AppendEntriesResponse,
    from |-> s1,
    to |-> s3,
    body |-> [term |-> 9, success |-> FALSE, curIdx |-> 0],
    seq |-> 69 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 2, success |-> TRUE, curIdx |-> 0],
    seq |-> 15 ],
  [ type |-> AppendEntriesResponse,
    from |-> s2,
    to |-> s3,
    body |-> [term |-> 5, success |-> FALSE, curIdx |-> 0],
    seq |-> 37 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 4, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 28 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 54 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s2,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 62 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 8, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 55 ],
  [ type |-> RequestVoteRequest,
    from |-> s1,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s1, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 63 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 3, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 22 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 24 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 8, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 52 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 64 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 66 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s1,
    body |->
        [term |-> 11, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 72 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 4, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 25 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 5, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 34 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 6, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 43 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 7, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 47 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 9, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 65 ],
  [ type |-> RequestVoteRequest,
    from |-> s2,
    to |-> s3,
    body |->
        [term |-> 10, candidate |-> s2, lastLogIdx |-> 0, lastLogTerm |-> 0],
    seq |-> 67 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s1,
    body |->
        [term |-> 6, candidate |-> s3, lastLogIdx |-> 6, lastLogTerm |-> 2],
    seq |-> 70 ],
  [ type |-> RequestVoteRequest,
    from |-> s3,
    to |-> s2,
    body |->
        [term |-> 6, candidate |-> s3, lastLogIdx |-> 6, lastLogTerm |-> 2],
    seq |-> 71 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 5, voteGranted |-> FALSE],
    seq |-> 45 ],
  [ type |-> RequestVoteResponse,
    from |-> s1,
    to |-> s2,
    body |-> [term |-> 7, voteGranted |-> TRUE],
    seq |-> 50 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s1,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 51 ],
  [ type |-> RequestVoteResponse,
    from |-> s3,
    to |-> s2,
    body |-> [term |-> 2, voteGranted |-> FALSE],
    seq |-> 56 ] }
/\ matchIndex = ( s1 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s2 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) @@
  s3 :> (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0) )
/\ log = ( s1 :> <<>> @@
  s2 :> <<>> @@
  s3 :>
      << [term |-> 2, value |-> v1],
         [term |-> 2, value |-> v5],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v2],
         [term |-> 2, value |-> v4],
         [term |-> 2, value |-> v1] >> )
/\ pc = <<"DoLoop: RequestVote", s2, s1, 72>>
/\ state = (s1 :> Candidate @@ s2 :> Candidate @@ s3 :> Candidate)
/\ commitIndex = (s1 :> 0 @@ s2 :> 0 @@ s3 :> 0)
/\ currentTerm = (s1 :> 9 @@ s2 :> 11 @@ s3 :> 6)
/\ nextIndex = ( s1 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s2 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) @@
  s3 :> (s1 :> 1 @@ s2 :> 1 @@ s3 :> 1) )
/\ votesGranted = (s1 :> {s1} @@ s2 :> {s2} @@ s3 :> {s3})
/\ scr = [ lock |-> [type |-> RequestVoteRequest, args |-> {[from |-> s2, to |-> s3]}],
  nSent |-> 72 ]
/\ votedFor = (s1 :> s1 @@ s2 :> s2 @@ s3 :> s3)


=================================================
